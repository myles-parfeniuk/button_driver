\doxysection{Button Class Reference}
\label{class_button}\index{Button@{Button}}


Class representing push-\/button or tactile switch, has self-\/contained driver.  




{\ttfamily \#include $<$Button.\+hpp$>$}

\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \textbf{ button\+\_\+config\+\_\+t}
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum class \textbf{ Button\+Event} \{ \textbf{ quick\+\_\+press}
, \textbf{ long\+\_\+press}
, \textbf{ held}
, \textbf{ released}
 \}
\begin{DoxyCompactList}\small\item\em the different kinds of button events that can be detected \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ Button} (\textbf{ button\+\_\+config\+\_\+t} \textbf{ button\+\_\+conf}, bool \textbf{ logging\+\_\+en}=false, const char $\ast$\textbf{ name}=\"{}unamed\"{})
\begin{DoxyCompactList}\small\item\em Construct a new \doxyref{Button}{p.}{class_button} object. \end{DoxyCompactList}\item 
bool \textbf{ scan} ()
\begin{DoxyCompactList}\small\item\em Scan for button event. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\label{class_button_a77c3cd3d62682c2ae22f43cb301329d3} 
Data\+Control\+::\+Call\+Always$<$ \textbf{ Button\+Event} $>$ {\bfseries event}
\begin{DoxyCompactList}\small\item\em Data\+Wrapper containing button event, call-\/back function can be registered to button with follow() method (see data\+\_\+control documentation) \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \textbf{ get\+\_\+button\+\_\+level} ()
\begin{DoxyCompactList}\small\item\em Get level of a button, called from button task. \end{DoxyCompactList}\item 
void \textbf{ generate\+\_\+quick\+\_\+press\+\_\+evt} ()
\begin{DoxyCompactList}\small\item\em Generate a quick-\/press event. \end{DoxyCompactList}\item 
void \textbf{ generate\+\_\+long\+\_\+press\+\_\+evt} ()
\begin{DoxyCompactList}\small\item\em Generate a long-\/press event. \end{DoxyCompactList}\item 
void \textbf{ generate\+\_\+held\+\_\+evt} ()
\begin{DoxyCompactList}\small\item\em Generate a held event. \end{DoxyCompactList}\item 
void \textbf{ generate\+\_\+released\+\_\+evt} ()
\begin{DoxyCompactList}\small\item\em Generate a released event. \end{DoxyCompactList}\item 
bool \textbf{ press\+\_\+check} ()
\begin{DoxyCompactList}\small\item\em Detect quick-\/press or long-\/press event. \end{DoxyCompactList}\item 
void \textbf{ released\+\_\+check} ()
\begin{DoxyCompactList}\small\item\em Generate held events until button is released. \end{DoxyCompactList}\item 
void \textbf{ button\+\_\+task} ()
\begin{DoxyCompactList}\small\item\em Task responsible for detecting and generating events. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Static Private Member Functions}
\begin{DoxyCompactItemize}
\item 
static void IRAM\+\_\+\+ATTR \textbf{ button\+\_\+handler} (void $\ast$arg)
\begin{DoxyCompactList}\small\item\em ISR handler responsible for handling button activity. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\label{class_button_a3b973cad54cbb17738dc442a2242935e} 
\textbf{ button\+\_\+config\+\_\+t} {\bfseries button\+\_\+conf}
\begin{DoxyCompactList}\small\item\em the button configuration settings \end{DoxyCompactList}\item 
\label{class_button_a0a42e1a4f8a5dc2fd1ef15a07794e089} 
bool {\bfseries initialized}
\begin{DoxyCompactList}\small\item\em whether or not the task has been created and initially suspended \end{DoxyCompactList}\item 
\label{class_button_a6277c0ef74f409a3a5a1af0b0ffaca7c} 
bool {\bfseries logging\+\_\+en}
\begin{DoxyCompactList}\small\item\em true to enable debugging logs, false otherwise \end{DoxyCompactList}\item 
\label{class_button_a0bb59aba9e0eddec6231e44a825578f2} 
bool {\bfseries pending\+\_\+scan}
\begin{DoxyCompactList}\small\item\em true if an event has been asserted since the last time \doxyref{scan()}{p.}{class_button_a713b68291767522afcc497527010583f} was called \end{DoxyCompactList}\item 
\label{class_button_a7f62bfcedac3168177a12db8483e3e3a} 
const char $\ast$ {\bfseries name}
\begin{DoxyCompactList}\small\item\em name of button, used in debugging logs \end{DoxyCompactList}\item 
\label{class_button_a99b85cf13fe7c7200e1a5e369bfb90ca} 
Task\+Wrapper$<$ \textbf{ Button} $>$ {\bfseries task}
\begin{DoxyCompactList}\small\item\em Task\+Wrapper that encapsulates the button\+\_\+task. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
\label{class_button_a2d65daf4266db3718f2ea475315f0451} 
static const constexpr char $\ast$ {\bfseries TAG} = \"{}Button\"{}
\begin{DoxyCompactList}\small\item\em class tag, used in debug logs \end{DoxyCompactList}\item 
\label{class_button_ac7a7ea213cdfc221d42d457d89e44906} 
static bool {\bfseries isr\+\_\+service\+\_\+installed} = \{false\}
\begin{DoxyCompactList}\small\item\em true of the isr service has been installed, false until first button is created \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Class representing push-\/button or tactile switch, has self-\/contained driver. 

Contains information representing a button or tactile switch and methods to interact with it. GPIO and ISR for button is set up from constructor when a button object is created.

Call the follow() method on the event member of a button to register a call-\/back function (see data\+\_\+control documentation for more info on follow()). Call-\/back functions can be registered in as many places as desired using follow(), where each button event can be handled in multiple places, independently.

Any call-\/back functions registered to a button\textquotesingle{}s event member will be executed every time a button event is detected. ~\newline


\begin{DoxyAuthor}{Author}
Myles Parfeniuk 
\end{DoxyAuthor}


\doxysubsection{Class Documentation}
\index{Button::button\_config\_t@{Button::button\_config\_t}}\label{struct_button_1_1button__config__t}
\doxysubsubsection{struct Button\+::button\+\_\+config\+\_\+t}
\begin{DoxyFields}{Class Members}
\mbox{\label{class_button_abef78ddd69435d1f26d68a35339ac5cc}} 
bool&
active\_hi&
true if the button is active-\/high (rising edge), false if otherwise \\
\hline

\mbox{\label{class_button_a2aa34145638fc1b06114049df51c6856}} 
bool&
active\_lo&
true if the button is active-\/low (falling edge), false if otherwise \\
\hline

\mbox{\label{class_button_a2ebaf46b191200ea3592583458ca55aa}} 
gpio\_num\_t&
gpio\_num&
the gpio number associated with the button \\
\hline

\mbox{\label{class_button_a323384aa42fac17b4be81bc260dcf0e7}} 
int64\_t&
held\_evt\_time&
held event generation time in microseconds (us), if the button is held for longer than (25ms+long\+\_\+press\+\_\+evt\+\_\+time+hold\+\_\+evt\+\_\+time), ~\newline
 held events will be generated every held\+\_\+evt\+\_\+time us \\
\hline

\mbox{\label{class_button_ae8f9eaa509e284fd381a1d8acd259407}} 
int64\_t&
long\_press\_evt\_time&
long-\/press event generation time in microseconds (us), if the button is held for longer than (long\+\_\+press\+\_\+evt\+\_\+time+25ms) a long-\/press event is generated, if it is released before (long\+\_\+press\+\_\+evt\+\_\+time+25ms) elapses a quick-\/press event is generated instead \\
\hline

\mbox{\label{class_button_a7ce7d7d90124d2316b89cd1d796dbb31}} 
bool&
pull\_en&
true if internal pullup (for active low) or pulldown (for active high) should be enabled, false if using external pullup/pulldown \\
\hline

\end{DoxyFields}


\doxysubsection{Member Enumeration Documentation}
\label{class_button_a8116e8c26b547c2801572f7b45aceea8} 
\index{Button@{Button}!ButtonEvent@{ButtonEvent}}
\index{ButtonEvent@{ButtonEvent}!Button@{Button}}
\doxysubsubsection{ButtonEvent}
{\footnotesize\ttfamily enum class \textbf{ Button\+::\+Button\+Event}\hspace{0.3cm}{\ttfamily [strong]}}



the different kinds of button events that can be detected 

\begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{quick\_press@{quick\_press}!Button@{Button}}\index{Button@{Button}!quick\_press@{quick\_press}}}\label{class_button_a8116e8c26b547c2801572f7b45aceea8aead9be15f56a79815ce4b75f6ada4954} 
quick\+\_\+press&quick-\/press event, generated if button is pressed, then released before (25ms + button-\/$>$button\+\_\+conf.\+long\+\_\+press\+\_\+evt\+\_\+time) elapses \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{long\_press@{long\_press}!Button@{Button}}\index{Button@{Button}!long\_press@{long\_press}}}\label{class_button_a8116e8c26b547c2801572f7b45aceea8a4c733dc96efea4f817573c76f22afefd} 
long\+\_\+press&long-\/press event, generated if button is pressed, and not released after (25ms + button-\/$>$button\+\_\+conf.\+long\+\_\+press\+\_\+evt\+\_\+time) elapses \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{held@{held}!Button@{Button}}\index{Button@{Button}!held@{held}}}\label{class_button_a8116e8c26b547c2801572f7b45aceea8a0eb29f5d6149e84750bcd6f6e741a7a1} 
held&held event, generated if button is held after long-\/press event has been generated, re-\/generates every button-\/$>$button\+\_\+conf-\/$>$hold\+\_\+evt\+\_\+time microseconds until button is released \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{released@{released}!Button@{Button}}\index{Button@{Button}!released@{released}}}\label{class_button_a8116e8c26b547c2801572f7b45aceea8a23690fd759f17135ec9879b56ff2600c} 
released&release event, generated when button is released (note, button release event not generated for quick-\/press events) \\
\hline

\end{DoxyEnumFields}


\doxysubsection{Constructor \& Destructor Documentation}
\label{class_button_aa04c84eccbac801a3f77fd36002dc486} 
\index{Button@{Button}!Button@{Button}}
\index{Button@{Button}!Button@{Button}}
\doxysubsubsection{Button()}
{\footnotesize\ttfamily Button\+::\+Button (\begin{DoxyParamCaption}\item[{\textbf{ button\+\_\+config\+\_\+t}}]{button\+\_\+conf,  }\item[{bool}]{logging\+\_\+en = {\ttfamily false},  }\item[{const char $\ast$}]{name = {\ttfamily \"{}unamed\"{}} }\end{DoxyParamCaption})}



Construct a new \doxyref{Button}{p.}{class_button} object. 

Constructs a new button object, if button\+\_\+conf is not correctly initialized an error message will be printed to terminal and a backtrace will be dumped.

For correct initialization, ensure that\+:


\begin{DoxyItemize}
\item button\+\_\+conf.\+active\+\_\+lo is the opposite of button\+\_\+conf.\+active\+\_\+hi (button can only be active high or active low, not both). An active high button is one that outputs a logic high when pressed, an active low button is one that outputs a logic low when pressed.
\item button\+\_\+conf.\+gpio\+\_\+num is correctly set with the gpio number that is connected to the button
\item button\+\_\+conf.\+long\+\_\+press\+\_\+evt\+\_\+time is between 10000us and 5000000us
\item button\+\_\+conf.\+held\+\_\+evt\+\_\+time is between 10000us and 5000000us
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em button\+\_\+conf} & button configuration information, contains information about whether the button is active high or low, which GPIO number is connected to button, event generation times, and if internal pullups/pulldowns should be enabled. \\
\hline
{\em logging\+\_\+en} & logging status, true to enable logging, false to disable (optional, default false) \\
\hline
{\em name} & name of button object, printed out with logs to aid debugging (optional, default \"{}unamed\"{})\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}


\doxysubsection{Member Function Documentation}
\label{class_button_a380a98af49d16f41dd9c8ba70ed03e23} 
\index{Button@{Button}!button\_handler@{button\_handler}}
\index{button\_handler@{button\_handler}!Button@{Button}}
\doxysubsubsection{button\_handler()}
{\footnotesize\ttfamily void IRAM\+\_\+\+ATTR Button\+::button\+\_\+handler (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



ISR handler responsible for handling button activity. 

This ISR is entered when a falling edge is detected (for an active low button) or a rising edge (for an active high button). It resumes the button\+\_\+task and disables the button\textquotesingle{}s interrupt. \doxyref{Button}{p.}{class_button} interrupt will be re-\/enabled in button\+\_\+task before it suspends itself, after a release event is detected.

button activity triggers isr -\/-\/$>$ interrupt disabled -\/-\/$>$ button\+\_\+task is resumed -\/-\/$>$ events are detected and generated -\/-\/$>$ button release detected -\/-\/$>$ interrupt enabled -\/$>$ button\+\_\+task\+\_\+suspended


\begin{DoxyParams}{Parameters}
{\em button} & the button to resume button\+\_\+task, and disable interrupt for \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}
\label{class_button_ac7e3de5e746361d1a4e6aa6a5bbcb793} 
\index{Button@{Button}!button\_task@{button\_task}}
\index{button\_task@{button\_task}!Button@{Button}}
\doxysubsubsection{button\_task()}
{\footnotesize\ttfamily void Button\+::button\+\_\+task (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Task responsible for detecting and generating events. 

This task is awoken by the button\+\_\+handler isr when any button activity is detected. It detects and generates events until the button is released. After the button is released the task suspends itself until it is again resumed from the button\+\_\+handler isr.

button activity triggers isr -\/-\/$>$ interrupt disabled -\/-\/$>$ button\+\_\+task is resumed -\/-\/$>$ events are detected and generated -\/-\/$>$ button release detected -\/-\/$>$ interrupt enabled -\/-\/$>$ button\+\_\+task suspended


\begin{DoxyParams}{Parameters}
{\em button} & the button to detect and generate events for \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}
\label{class_button_ac6805cf87bb0b7bb3308d2e604f4e7dd} 
\index{Button@{Button}!generate\_held\_evt@{generate\_held\_evt}}
\index{generate\_held\_evt@{generate\_held\_evt}!Button@{Button}}
\doxysubsubsection{generate\_held\_evt()}
{\footnotesize\ttfamily void Button\+::generate\+\_\+held\+\_\+evt (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Generate a held event. 

Generates a held event by calling set() method on this-\/$>$event. This will execute any call-\/backs registered to the button and set pending\+\_\+scan to true.


\begin{DoxyParams}{Parameters}
{\em button} & the button to generate a held event for \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}
\label{class_button_ab9fb6cdcec33c78c4814fc86701bdc7a} 
\index{Button@{Button}!generate\_long\_press\_evt@{generate\_long\_press\_evt}}
\index{generate\_long\_press\_evt@{generate\_long\_press\_evt}!Button@{Button}}
\doxysubsubsection{generate\_long\_press\_evt()}
{\footnotesize\ttfamily void Button\+::generate\+\_\+long\+\_\+press\+\_\+evt (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Generate a long-\/press event. 

Generates a long press event by calling set() method on this-\/$>$event. This will execute any call-\/backs registered to the button and set pending\+\_\+scan to true.


\begin{DoxyParams}{Parameters}
{\em button} & the button to generate a long-\/press event for \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}
\label{class_button_ac3631d3fe54a3496c5c4bf7e2c710c68} 
\index{Button@{Button}!generate\_quick\_press\_evt@{generate\_quick\_press\_evt}}
\index{generate\_quick\_press\_evt@{generate\_quick\_press\_evt}!Button@{Button}}
\doxysubsubsection{generate\_quick\_press\_evt()}
{\footnotesize\ttfamily void Button\+::generate\+\_\+quick\+\_\+press\+\_\+evt (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Generate a quick-\/press event. 

Generates a quick-\/press event by calling set() method on this-\/$>$event. This will execute any call-\/backs registered to the button and set pending\+\_\+scan to true.


\begin{DoxyParams}{Parameters}
{\em button} & the button to generate a quick-\/press event for \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}
\label{class_button_a93bece5aeb0aa85339d669f21e457b8e} 
\index{Button@{Button}!generate\_released\_evt@{generate\_released\_evt}}
\index{generate\_released\_evt@{generate\_released\_evt}!Button@{Button}}
\doxysubsubsection{generate\_released\_evt()}
{\footnotesize\ttfamily void Button\+::generate\+\_\+released\+\_\+evt (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Generate a released event. 

Generates a released event by calling set() method on this-\/$>$event. This will execute any call-\/backs registered to the button and set pending\+\_\+scan to true.


\begin{DoxyParams}{Parameters}
{\em button} & the button to generate a released event for \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}
\label{class_button_a606c22a20a0c5473812a789009d932f6} 
\index{Button@{Button}!get\_button\_level@{get\_button\_level}}
\index{get\_button\_level@{get\_button\_level}!Button@{Button}}
\doxysubsubsection{get\_button\_level()}
{\footnotesize\ttfamily bool Button\+::get\+\_\+button\+\_\+level (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Get level of a button, called from button task. 

Get the current level of a button (whether the button is currently being pressed or is inactive).


\begin{DoxyParams}{Parameters}
{\em button} & the button to read the level of \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if button is currently being pressed, false if button inactive 
\end{DoxyReturn}
\label{class_button_a2e9bf9e7463d7c82dbf7834c8a822274} 
\index{Button@{Button}!press\_check@{press\_check}}
\index{press\_check@{press\_check}!Button@{Button}}
\doxysubsubsection{press\_check()}
{\footnotesize\ttfamily bool Button\+::press\+\_\+check (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Detect quick-\/press or long-\/press event. 

Generates a quick-\/press event if button is released before (25ms + button-\/$>$button\+\_\+conf.\+long\+\_\+press\+\_\+evt\+\_\+time) elapse. Generates a long-\/press event otherwise.


\begin{DoxyParams}{Parameters}
{\em button} & the button to detect press type for \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}
\label{class_button_a2f3dfe22e3fcb1b2df144b3ae08b09b3} 
\index{Button@{Button}!released\_check@{released\_check}}
\index{released\_check@{released\_check}!Button@{Button}}
\doxysubsubsection{released\_check()}
{\footnotesize\ttfamily void Button\+::released\+\_\+check (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Generate held events until button is released. 

Generates held events every button-\/$>$button\+\_\+conf.\+held\+\_\+evt\+\_\+time microseconds. If the button is released a release event will be generated and the function will exit.


\begin{DoxyParams}{Parameters}
{\em button} & the button to detect release of and generate held events for \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}
\label{class_button_a713b68291767522afcc497527010583f} 
\index{Button@{Button}!scan@{scan}}
\index{scan@{scan}!Button@{Button}}
\doxysubsubsection{scan()}
{\footnotesize\ttfamily bool Button\+::scan (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Scan for button event. 

Scan to see if a button event has ocurred. This function can be used to poll a button, if it returns true, the get() method can be called to return the type of event which occurred (quick-\/press, long-\/press, held, released).

It is not recommended to handle button events this way, \doxyref{scan()}{p.}{class_button_a713b68291767522afcc497527010583f} can only be called in a single location (ie cannot be polled in two threads at once).

Instead of calling \doxyref{scan()}{p.}{class_button_a713b68291767522afcc497527010583f}, call the follow() method on the event member of a button to register a call-\/back function. Call-\/back functions can be registered in as many locations or threads as desired, where each button event can be handled in multiple places, independently.

\begin{DoxyReturn}{Returns}
void, nothing to return 
\end{DoxyReturn}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
D\+:/development/esp/projects/idf\+\_\+4\+\_\+0/data\+\_\+control\+\_\+rework/components/button\+\_\+driver/Button.\+hpp\item 
D\+:/development/esp/projects/idf\+\_\+4\+\_\+0/data\+\_\+control\+\_\+rework/components/button\+\_\+driver/Button.\+cpp\end{DoxyCompactItemize}
